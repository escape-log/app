<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é›†ä¸­ã‚¿ã‚¤ãƒãƒ¼</title>

<style>
.preset-btn.active {
    background: #4a90e2;
    color: white;
}
:root {
    --primary: #4a90e2;
    --danger: #e94b35;
    --success: #2ecc71;
    --bg: #f4f7f6;
}
body {
    font-family: sans-serif;
    background: var(--bg);
    display: flex;
    justify-content: center;
    padding: 20px;
}
.card {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
    text-align: center;
}
.timer {
    font-size: 5rem;
    font-weight: bold;
    margin: 20px 0;
}
.btn {
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
    margin: 5px;
}
.btn-start { background: var(--primary); color: white; }
.btn-stop { background: var(--danger); color: white; }

.today-stats {
    background: #f0f6ff;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.95rem;
}

.history {
    margin-top: 20px;
    text-align: left;
    max-height: 200px;
    overflow-y: auto;
    font-size: 0.9rem;
}
.success-text { color: var(--success); font-weight: bold; }
.fail-text { color: var(--danger); }
</style>
</head>
<body>

<div class="card">
<h2>é›†ä¸­ã‚¿ã‚¤ãƒãƒ¼</h2>

<div class="today-stats" id="todayStats"></div>
<div style="margin-bottom:10px; font-weight:bold;" id="todayTotal"></div>
<div style="margin-bottom:10px; font-weight:bold;" id="todayStreak"></div>
<!-- ã‚ˆãä½¿ã†æ™‚é–“ -->
<div style="margin:10px 0;">
    <div><strong>ã‚ˆãä½¿ã†ï¼š</strong></div>
    <div id="presetButtons"></div>

    <div style="margin-top:8px;">
        è¿½åŠ ï¼š
        <input type="number" id="addMinuteInput" min="1" style="width:80px;">
        <button id="addMinuteBtn">è¿½åŠ </button>
    </div>
</div>

<!-- è¿½åŠ ï¼šæ™‚é–“è¨­å®š -->
<div>
    <input type="number" id="minuteInput" placeholder="åˆ†æ•° (ä¾‹:25)" min="1" style="width:100px; padding:5px;">
</div>

<div class="timer" id="display">25:00</div>

<button class="btn btn-start" id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<button class="btn btn-stop" id="stopBtn" disabled>ä¸­æ–­</button>

<div class="history">
<h3>ã“ã‚Œã¾ã§ã®è¨˜éŒ²</h3>
<div id="historyList"></div>
</div>
</div>
<script>
// å®Œèµ°éŸ³
const finishAudio = new Audio("finish.ogg");

function playFinishSound() {
    finishAudio.currentTime = 0; // é€£ç¶šå†ç”Ÿå¯¾å¿œ
    finishAudio.play();
}
// ===== ãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ =====
const baseTimes = [25, 50];
const presetContainer = document.getElementById('presetButtons');
const addMinuteInput = document.getElementById('addMinuteInput');
const addMinuteBtn = document.getElementById('addMinuteBtn');

function getCustomTimes() {
    return JSON.parse(localStorage.getItem('customTimes') || "[]");
}

function saveCustomTimes(times) {
    localStorage.setItem('customTimes', JSON.stringify(times));
}

function renderPresetButtons() {
    const customTimes = getCustomTimes();
    const allTimes = [...baseTimes, ...customTimes];

   presetContainer.innerHTML = allTimes.map(min =>
    `<button class="preset-btn" data-min="${min}" style="margin:3px;">${min}åˆ†</button>`
).join('');
document.querySelectorAll('.preset-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const minutes = parseInt(btn.dataset.min);

        // ãƒã‚¤ãƒ©ã‚¤ãƒˆåˆ‡æ›¿
        document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        minuteInput.value = minutes;
        currentMinutes = minutes;
        timeLeft = minutes * 60;
        updateDisplay();

        // å‰å›æ™‚é–“ã‚’ä¿å­˜ï¼ˆæ”¹å–„â‘¡ï¼‰
        localStorage.setItem('lastMinutes', minutes);
    });
});

}

addMinuteBtn.addEventListener('click', () => {
    const value = parseInt(addMinuteInput.value);
    if (!value || value <= 0) return;

    let customTimes = getCustomTimes();

    // é‡è¤‡é˜²æ­¢ï¼ˆ25ãƒ»50ã‚‚å«ã‚ã‚‹ï¼‰
    if (baseTimes.includes(value) || customTimes.includes(value)) {
        addMinuteInput.value = "";
        return;
    }

    customTimes.push(value);
    saveCustomTimes(customTimes);

    addMinuteInput.value = "";
    renderPresetButtons();
});

// èµ·å‹•æ™‚ã«è¡¨ç¤º
// è¦ç´ å–å¾—ï¼ˆã¾ãšæœ€åˆï¼‰
const display = document.getElementById('display');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const historyList = document.getElementById('historyList');
const todayStats = document.getElementById('todayStats');
const minuteInput = document.getElementById('minuteInput');

// ã‚¿ã‚¤ãƒãƒ¼åˆæœŸå€¤
let defaultMinutes = 25;
let currentMinutes = defaultMinutes;
let timeLeft = defaultMinutes * 60;
let timerId = null;

// ãƒ—ãƒªã‚»ãƒƒãƒˆè¡¨ç¤º
renderPresetButtons();

// å‰å›æ™‚é–“ã®å¾©å…ƒ
const lastMinutes = parseInt(localStorage.getItem('lastMinutes'));
if (lastMinutes > 0) {
    minuteInput.value = lastMinutes;
    currentMinutes = lastMinutes;
    timeLeft = lastMinutes * 60;
}

// è¡¨ç¤ºæ›´æ–°
updateDisplay();
function updateDisplay() {
    const m = Math.floor(timeLeft / 60);
    const s = timeLeft % 60;
    display.textContent =
        m.toString().padStart(2,'0') + ':' +
        s.toString().padStart(2,'0');
}

// ä»Šæ—¥ã®çµ±è¨ˆ
function renderTodayStats() {
    const logs = JSON.parse(localStorage.getItem('timerLogs') || "[]");
    const today = new Date().toISOString().slice(0,10);

    let success = 0;
    let fail = 0;

    logs.forEach(log => {
        if (log.date.slice(0,10) === today) {
            if (log.status === "å®Œèµ°") success++;
            if (log.status === "æŒ«æŠ˜") fail++;
        }
    });

    const total = success + fail;
    const rate = total ? ((fail/total)*100).toFixed(1) : 0;

    todayStats.innerHTML = `
    <strong>ä»Šæ—¥</strong><br>
    å®Œèµ°: ${success}å›<br>
    æŒ«æŠ˜: ${fail}å›<br>
    æŒ«æŠ˜ç‡: ${rate}%`;
}

// â†ã“ã“ã§å®Œå…¨ã«é–‰ã˜ã‚‹ã®ãŒå¤§äº‹


// ä»Šæ—¥ã®åˆè¨ˆé›†ä¸­æ™‚é–“ï¼ˆâ†åˆ¥ã®é–¢æ•°ã¨ã—ã¦å¤–ã«ç½®ãï¼‰
function renderTodayTotal() {
    const logs = JSON.parse(localStorage.getItem('timerLogs') || "[]");
    const today = new Date().toISOString().slice(0,10);

    let totalMinutes = 0;

    logs.forEach(log => {
        if (log.date.slice(0,10) === today && log.status === "å®Œèµ°") {
            totalMinutes += log.minutes || defaultMinutes;        }
    });

    document.getElementById('todayTotal').textContent =
        "ä»Šæ—¥ã®é›†ä¸­åˆè¨ˆ: " + totalMinutes + "åˆ†";
}
function renderTodayStreak() {
    const logs = JSON.parse(localStorage.getItem('timerLogs') || "[]");

    let streak = 0;

    // æ–°ã—ã„é †ã«ãƒã‚§ãƒƒã‚¯
    for (let log of logs) {
        if (log.status === "å®Œèµ°") {
            streak++;
        } else {
            break; // æŒ«æŠ˜ãŒå‡ºãŸã‚‰ã‚¹ãƒˆãƒƒãƒ—
        }
    }

    document.getElementById('todayStreak').textContent =
        "é€£ç¶šæˆåŠŸ: " + streak + "å› ğŸ”¥";
}
// ãƒ­ã‚°ä¿å­˜
function saveLog(status, reason="", minutes=0) {
    const logs = JSON.parse(localStorage.getItem('timerLogs') || "[]");
    logs.unshift({
        date: new Date().toISOString(),
        status,
        reason,
        minutes
    });
    localStorage.setItem('timerLogs', JSON.stringify(logs));
    renderLogs();
    renderTodayStats();
    renderTodayTotal();  
    renderTodayStreak();
}

// å±¥æ­´è¡¨ç¤º
function renderLogs() {
    const logs = JSON.parse(localStorage.getItem('timerLogs') || "[]");
    historyList.innerHTML = logs.map(log => {
        const d = new Date(log.date).toLocaleString();
        return `
        <div>
        ${d} -
        <span class="${log.status==='å®Œèµ°'?'success-text':'fail-text'}">
        ${log.status}
        </span>
        ${log.reason?'<br><small>'+log.reason+'</small>':''}
        </div>`;
    }).join('');
}

// ã‚¹ã‚¿ãƒ¼ãƒˆ
startBtn.addEventListener('click', () => {
    if (timerId) return;

    // å…¥åŠ›å€¤ã‚’å–å¾—
    const inputMinutes = parseInt(minuteInput.value) || 0;
    const minutes = inputMinutes > 0 ? inputMinutes : defaultMinutes;
    currentMinutes = minutes;

    timeLeft = minutes * 60;
    updateDisplay();

    startBtn.disabled = true;
    stopBtn.disabled = false;

    timerId = setInterval(() => {
        timeLeft--;
        updateDisplay();

      if (timeLeft <= 0) {
    clearInterval(timerId);
    timerId = null;
    playFinishSound();   // â†è¿½åŠ 
    alert("å®Œèµ°ã—ã¾ã—ãŸï¼");
    saveLog("å®Œèµ°", "", minutes);
    resetTimer();
}
    }, 1000);
});

// ä¸­æ–­
stopBtn.addEventListener('click', () => {
    const reason = prompt("ä¸­æ–­ç†ç”±:");
    if (reason !== null) {
        clearInterval(timerId);
        timerId = null;
        const remainingMinutes = Math.ceil(timeLeft / 60);
saveLog("æŒ«æŠ˜", reason || "", remainingMinutes);
       resetTimer();
    }
});

function resetTimer() {
    timeLeft = currentMinutes * 60;
    updateDisplay();
    startBtn.disabled = false;
    stopBtn.disabled = true;
}

updateDisplay();
renderLogs();
renderTodayStats();
renderTodayTotal();
renderTodayStreak(); 
</script>

</body>

</html>
